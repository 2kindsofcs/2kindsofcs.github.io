express와 websocket

나: 채팅방에 메세지를 쏴주는 것은 "트위터로 로그인하기" 기능과 전혀 연관이 없으므로 기존에 만들었던 index.js에 작성하는 게 아니라 다른 파일로 만들어서 써야할 것 같습니다. 
선생님: 기능 단위로 쪼개는 것도 중요하지만, 그 기능들을 하나로 묶어주는 애도 필요하다. 고려를 해야함. 묶어주는 주체가 이번 케이스 같은 경우에는 express이다. express를 중심으로 묶을 것을 고려해서 쪼개는 게 좋음. 
express는 http 요청을 해석을 해주고 그 응답을 response로 만들어서 보내준다. 
웹소켓은 http를 활용한 프로토콜인데 , 포트를 같이 쓰려고 하면 익스프레스가 요청이 들어오는 패스를 보고 웹소켓에게 넘겨줄 수가 있다. 넘겨주면 웹소켓 서버가 가져가서 동작을 하는 것. 
트래픽이 도메인과 주소를 보고 하나는 웹소켓, 하나는 익스프레스로 줄 수도 있겠지만 깔끔하지 못하다. 

며칠을 문서들을 보며 고민하다가 진척이 없었는데, 첫 단계를 해결했다.
유저가 "트위터로 로그인하기" 버튼을 누르면 트위터 로그인 페이지로 redirect되는 것까지 성공시켰다. 
aouth 깃헙 저장소에 있던 예시 코드들을 참조해서 작성했는데, 해당 예시들을 봤을 때는 정말 보기가 힘들었는데 막상 짜고 나니까 좀 덜 어렵게 느껴진다. 요청해서 받은 oauth token과 oauth token secret을 세션에 저장하였다. 

오늘 깨달은 것 

- 오래된 코드를 참조할 때, 모듈이 아예 별개의 라이브러리로 분리되어 있을 수 있다. 오늘같은 경우 session이 원래 express에 포함되어 있었는데, 막상 메소드 자동완성이 되지 않아 npm에서 따로 검색해서 설치해서 사용했다.  

- 간혹 npm 예시 코드로 자기가 유닛 테스트 하던 파일의 코드 일부를 떼서 올리는 사람들이 있다. 안의 내용물만 유의해서 보자.  

- 어떤 목표를 달성하기 위해서는 "반드시" 취해야만 하는 동작들이 있다. 마법은 없으니까. 따라서 코드가 이해가 안 될 때는 "반드시" 취해야 하는 동작들이 어느 부분에서 처리되고 있는지를 중심으로 다시 한번 천천히 살펴보자. 
